# Concepts
## Data Model
 
프로메테우스는 근본적으로 모든 데이터를 시계열로 저장한다.      
시계열은 동일한 메트릭과 동일한 레이블을 가진 차원 셋에 속하는 값들의 시간 상의 흐름을 나타낸다.      
이렇게 저장하는 시계열 데이터 외에도, 프로메테우스는 쿼리로 만들어지는 파생 시계열을 임시로 생성할 수도 있다.  

### Metric names labels   

모든 시계열은 `메트릭 이름`과, `레이블`이라 부르는 생략 가능한 키/값 쌍들로 고유하게 식별할 수 있다.       

**메트릭 이름**
* 시스템에서 측정할 전반적인 특성을 명명한다.
    * 예: http_requests_total - HTTP 요청을 수신한 총 횟수  
* 메트릭 이름에는 ASCII 문자와 숫자, 밑줄, 콜론을 사용할 수 있으며 반드시 정규식`[a-zA-Z_:][a-zA-Z0-9_:]*`과 매칭되어야 한다.   
* 단, 콜론은 사용자가 정의하는 recording rule 용으로 예약되어있어 익스포터/직접계층 사용 불가능하다.   
* 
  
**레이블**   
* 메트릭 이름이 같을 땐, 레이블의 조합으로 특정한 차원에 속하는 실제 지표를 식별한다.
    * 예: /api/tracks 핸들러에 POST로 보낸 모든 HTTP 요청등 
    * 쿼리 언어는 이 차원을 기반으로 데이터를 필터링하고 집계한다.   
* 레이블 값을 변경하면 새 시계열 데이터가 생성된다.(레이블을 추가하거나 제거할 때도 마찬가지다.) 
* 레이블 '이름'에는 ASCII 문자와, 숫자, 밑줄을 사용할 수 있으며 반드시 정규식 `[a-zA-Z_:][a-zA-Z0-9_:]*`와 매칭되어야 한다.    
* `__`로 시작하는 레이블은 내부용도로 예약되어 있다.   
* 레이블 '값'에는 모든 유니코드 문자를 사용할 수 있다.   
* 레이블 값이 비어 있으면 존재하지 않는 레이블과 동일하게 취급한다.   

메트릭과 레이블 이름에 대한 [베스트 프랙티스](https://godekdls.github.io/Prometheus/practices.naming/)   

### Samples 

샘플들이 모여 실제 시계열 데이터를 형성한다.   
각 샘플은 다음과 같이 구성된다.  

* float64 값 하나 
* 밀리세컨드 단위 타임스탬프 하나 


### Notation

메트릭 이름과 레이블 셋이 있을 땐, 흔히 아래와 같은 표기법을 통해 시계열 데이터를 식별한다.   

```
<metric name>{<label name>=<label value>, ...}
```

메트릭 이름이 `api_http_request_total`이고,    
`metho="POST"`, `handler="/messages`를 레이블로 가지고 있는 시계열은 다음과 같이 작성할 수 있다.   

```
api_http_requests_total{method="POST", handler="/messages"}. 
``` 
이 표기법은 [OpenTSDB](http://opentsdb.net/) 에서 사용하는 것과 같은 표기법이다.    

## Metric Types   
 
프로메테우스 클라이언트 라이브러리는 4가지 핵심 메트릭 타입을 제공한다.       
이 타입들은 현재 클라이언트 라이브러리(사용하는 타입에 맞는 API를 제공하는 용도)와 와이어 프로콜에서만 구분하고 있다.     
프로메테우스 서버는 아직까진 타입 정보를 사용하지 않으며, 모든 데이터를 타입이 없는 시계열로 펼처버린다.(향후엔 변경될 수도 있다.)   

* Counter 
* Gauge 
* Histogram
* Summary

### Counter   

카운터는 누적되는 메트릭으로, 값이 커지거나 재시작시 0으로 리셋하는 것만 가능한 단순히 증가하는 카운터 하나를 나타낸다.   
예를 들어, 카운터를 사용해 서빙한 요청수나, 완료한 태스크 수, 에러 횟수 등을 표현할 수 있다.   
 
감소할 수도 있는 값을 표현할 땐 카운터를 사용하면 안 된다.     
예를 들면, 현재 실행중인 프로세스 수엔 카운터가 아니라 게이지를 사용해야한다.  


### Gauge  

게이지는 임의대로 올라가거나 내려갈 수 있는 단일 숫자 값을 나타내는 메트릭이다.       
전형적으로 게이지는 온도나 현재 메모리 사용량같은 지표를 측정할 때 사용하지만,     
동시에 요청 수와 같이 증가할 수도 감소할 수도 있는 "횟수" 에서도 사용한다.    

### Histogram

히스토그램은 관측 결과를 샘플링하면서 설정한 버킷들에 카운팅한다.(보통 요청 지속 시간이나 응답 크기같은 것들)         
관찰한 모든 값들의 합계도 함께 제공한다.       

히스토그램을 스크랩하면 여러 가지 시계열을 노출하게 된다.     
`<basename>`을 메트릭 이름으로 가진 히스토그램은 다음과 같은 데이터를 노출한다.   

* `<basename>_becket{le="<upper inclusive bound>"}` 로 노출하는 관측 버킷들에 대한 누적 카운터   
* `<basename>_sum` 으로 노출하는, 모든 관측 값들의 총합
* `<basename>_count` 로 노출하는, 관찰한 이벤트들의 갯수  
* `<basename>_bucket{ie="+Inf"}`와 동일 


### Summary

히스토그램과 유사하게 summary 도 관측 결과를 샘플링한다.(보통 요청 지속 시간이나 응답 크기 같은 것들)      
마찬가지로 총 관측 횟수와 관측한 모든 값들의 함계를 제공하지만, sumamry는 슬라이딩 time 윈도우를 통해 설정해둔 분위수를 계산한다.   
 
summary를 스크랩하면 여러가지 시계열을 노출하게 된다.      
`<basename>`을 메트릭 이름으로 가진 summary는 다음과 같은 데이터를 노출한다.   

* `<basename>{quantile="<~>"}` 노출하는, 관찰한 이벤트들의 스트리밍 
* `<basename>_sum`을 노출하느, 모든 관측 값들의 총합 
* `<basename>_count`로 노출하는, 관찰한 이벤트의 갯수 


## Jobs and Instances


